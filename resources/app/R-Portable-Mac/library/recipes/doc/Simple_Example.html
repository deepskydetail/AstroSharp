<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Basic Recipes</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 800px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 20px;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 0;
padding: 4px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table:not([class]) {
margin: auto;
min-width: 40%;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table[summary="R argblock"] {
width: 100%;
border: none;
}
table:not([class]) th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table:not([class]) td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table:not([class]), table:not([class]) th, table:not([class]) td {
border-left-style: none;
border-right-style: none;
}
table:not([class]) tr.odd {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 13px;
padding-bottom: 1px;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f5f5f5;
border-radius: 3px;
color: #333;
}
pre {
overflow-x: auto;
border-radius: 3px;
margin: 5px 0 10px 0;
padding: 10px;
}
pre:not([class]) {
background-color: white;
border: #f5f5f5 1px solid;
}
pre:not([class]) code {
color: #444;
background-color: white;
}
code {
font-family: monospace;
font-size: 90%;
}
p > code, li > code {
padding: 2px 4px;
color: #d14;
border: 1px solid #e1e1e8;
white-space: inherit;
}
div.figure {
text-align: center;
}
table > caption, div.figure p.caption {
font-style: italic;
}
table > caption span, div.figure p.caption span {
font-style: normal;
font-weight: bold;
}
p {
margin: 0 0 10px;
}
table:not([class]) {
margin: auto auto 10px auto;
}
img:not([class]) {
background-color: #FFFFFF;
padding: 2px;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
max-width: 100%;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f5f5f5;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f5f5f5;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f5f5f5;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }
div.r-help-page {
background-color: #f9f9f9;
border-bottom: #ddd 1px solid;
margin-bottom: 10px;
padding: 10px;
}
div.r-help-page:hover {
background-color: #f4f4f4;
}

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Basic Recipes</h1>


<div id="TOC">
<ul>
<li><a href="#an-example">An Example</a></li>
<li><a href="#an-initial-recipe">An Initial Recipe</a></li>
<li><a href="#preprocessing-steps">Preprocessing Steps</a></li>
<li><a href="#adding-steps">Adding Steps</a></li>
<li><a href="#checks">Checks</a></li>
</ul>
</div>

<p>This document demonstrates some basic uses of recipes. First, some definitions are required:</p>
<ul>
<li><strong>variables</strong> are the original (raw) data columns in a data frame or tibble. For example, in a traditional formula <code>Y ~ A + B + A:B</code>, the variables are <code>A</code>, <code>B</code>, and <code>Y</code>.</li>
<li><strong>roles</strong> define how variables will be used in the model. Examples are: <code>predictor</code> (independent variables), <code>response</code>, and <code>case weight</code>. This is meant to be open-ended and extensible.</li>
<li><strong>terms</strong> are columns in a design matrix such as <code>A</code>, <code>B</code>, and <code>A:B</code>. These can be other derived entities that are grouped such a a set of principal components or a set of columns that define a basis function for a variable. These are synonymous with features in machine learning. Variables that have <code>predictor</code> roles would automatically be main effect terms</li>
</ul>
<section id="an-example" class="level2">
<h2>An Example</h2>
<p>The cell segmentation data will be used. It has 58 predictor columns, a factor variable <code>Class</code> (the outcome), and two extra labelling columns. Each of the predictors has a suffix for the optical channel (<code>&quot;Ch1&quot;</code>-<code>&quot;Ch4&quot;</code>). We will first separate the data into a training and test set then remove unimportant variables:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(recipes)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(caret)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">data</span>(segmentationData)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">seg_train &lt;-<span class="st"> </span>segmentationData <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(Case <span class="op">==</span><span class="st"> &quot;Train&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Case, <span class="op">-</span>Cell)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">seg_test  &lt;-<span class="st"> </span>segmentationData <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(Case <span class="op">==</span><span class="st"> &quot;Test&quot;</span>)  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Case, <span class="op">-</span>Cell)</a></code></pre></div>
<p>The idea is that the preprocessing operations will all be created using the training set and then these steps will be applied to both the training and test set.</p>
</section>
<section id="an-initial-recipe" class="level2">
<h2>An Initial Recipe</h2>
<p>For a first recipe, let’s plan on centering and scaling the predictors. First, we will create a recipe from the original data and then specify the processing steps.</p>
<p>Recipes can be created manually by sequentially adding roles to variables in a data set.</p>
<p>If the analysis only required <strong>outcomes</strong> and <strong>predictors</strong>, the easiest way to create the initial recipe is to use the standard formula method:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">rec_obj &lt;-<span class="st"> </span><span class="kw">recipe</span>(Class <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> seg_train)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">rec_obj</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; Data Recipe</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; Inputs:</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;       role #variables</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;    outcome          1</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;  predictor         58</span></a></code></pre></div>
<p>The data contained in the <code>data</code> argument need not be the training set; this data is only used to catalog the names of the variables and their types (e.g. numeric, etc.).</p>
<p>(Note that the formula method here is used to declare the variables and their roles and nothing else. If you use inline functions (e.g. <code>log</code>) it will complain. These types of operations can be added later.)</p>
</section>
<section id="preprocessing-steps" class="level2">
<h2>Preprocessing Steps</h2>
<p>From here, preprocessing steps can be added sequentially in one of two ways:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">rec_obj &lt;-<span class="st"> </span><span class="kw">step_name</span>(rec_obj, arguments)    ## or</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">rec_obj &lt;-<span class="st"> </span>rec_obj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">step_name</span>(arguments)</a></code></pre></div>
<p><code>step_center</code> and the other functions will always return updated recipes.</p>
<p>One other important facet of the code is the method for specifying which variables should be used in different steps. The manual page <code>?selections</code> has more details but <a href="https://cran.r-project.org/package=dplyr"><code>dplyr</code></a>-like selector functions can be used:</p>
<ul>
<li>use basic variable names (e.g. <code>x1, x2</code>),</li>
<li><a href="https://cran.r-project.org/package=dplyr"><code>dplyr</code></a> functions for selecting variables: <code>contains</code>, <code>ends_with</code>, <code>everything</code>, <code>matches</code>, <code>num_range</code>, and <code>starts_with</code>,</li>
<li>functions that subset on the role of the variables that have been specified so far: <code>all_outcomes</code>, <code>all_predictors</code>, <code>has_role</code>, or</li>
<li>similar functions for the type of data: <code>all_nominal</code>, <code>all_numeric</code>, and <code>has_type</code>.</li>
</ul>
<p>Note that the functions listed above are the only ones that can be used to selecto variables inside the steps. Also, minus signs can be used to deselect variables.</p>
<p>For our data, we can add the two operations for all of the predictors:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">standardized &lt;-<span class="st"> </span>rec_obj <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw">step_center</span>(<span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw">step_scale</span>(<span class="kw">all_predictors</span>()) </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">standardized</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; Data Recipe</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; Inputs:</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;       role #variables</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;    outcome          1</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  predictor         58</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; Operations:</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; Centering for all_predictors()</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; Scaling for all_predictors()</span></a></code></pre></div>
<p>It is important to realize that the <em>specific</em> variables have not been declared yet (in this example). In some preprocessing steps, variables will be added or removed from the current list of possible variables.</p>
<p>If this is the only preprocessing steps for the predictors, we can now estimate the means and standard deviations from the training set. The <code>prep</code> function is used with a recipe and a data set:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">trained_rec &lt;-<span class="st"> </span><span class="kw">prep</span>(standardized, <span class="dt">training =</span> seg_train)</a></code></pre></div>
<p>Now that the statistics have been estimated, the preprocessing can be applied to the training and test set:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">train_data &lt;-<span class="st"> </span><span class="kw">bake</span>(trained_rec, <span class="dt">newdata =</span> seg_train)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">test_data  &lt;-<span class="st"> </span><span class="kw">bake</span>(trained_rec, <span class="dt">newdata =</span> seg_test)</a></code></pre></div>
<p><code>bake</code> returns a tibble that, by default, includes all of the variables:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">class</span>(test_data)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">test_data</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; # A tibble: 1,010 x 59</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;    Class AngleC… AreaC… AvgIn… AvgIn… AvgIn… AvgInt… Convex… Conve… DiffI…</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;    &lt;fct&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  1 PS     1.07   -0.647 -0.684 -1.18  -0.926 -0.924  -0.420   0.337 -0.870</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  2 PS    -1.80   -0.185 -0.632 -0.479 -0.809 -0.667  -0.493   0.814 -0.829</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  3 WS    -1.03   -0.707  1.21   3.04   0.348  1.39   -0.986   1.28   0.372</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  4 WS     1.69   -0.684  0.806  2.66   0.296  0.893  -0.947   1.16   0.307</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  5 PS     1.81   -0.342 -0.668 -1.17  -0.843 -0.928  -0.0583 -0.803 -0.887</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  6 WS    -1.48    0.784 -0.682 -0.628 -0.881 -0.594  -0.0969 -0.920 -0.920</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  7 WS     1.27    0.272 -0.672 -0.625 -0.809 -0.516  -0.249  -0.367 -0.944</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;  8 WS    -1.58    0.457  0.283  1.32  -0.613 -0.0891 -0.831   1.02  -0.126</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;  9 PS    -0.796  -0.412 -0.669 -1.17  -0.845 -0.926   0.382  -1.19  -0.889</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; 10 PS     0.0363 -0.638 -0.535  0.182 -0.555 -0.0253 -0.846   1.11  -0.819</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; # ... with 1,000 more rows, and 49 more variables: DiffIntenDensityCh3</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; #   &lt;dbl&gt;, DiffIntenDensityCh4 &lt;dbl&gt;, EntropyIntenCh1 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; #   EntropyIntenCh3 &lt;dbl&gt;, EntropyIntenCh4 &lt;dbl&gt;, EqCircDiamCh1 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; #   EqEllipseLWRCh1 &lt;dbl&gt;, EqEllipseOblateVolCh1 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; #   EqEllipseProlateVolCh1 &lt;dbl&gt;, EqSphereAreaCh1 &lt;dbl&gt;, EqSphereVolCh1</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; #   &lt;dbl&gt;, FiberAlign2Ch3 &lt;dbl&gt;, FiberAlign2Ch4 &lt;dbl&gt;, FiberLengthCh1</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; #   &lt;dbl&gt;, FiberWidthCh1 &lt;dbl&gt;, IntenCoocASMCh3 &lt;dbl&gt;, IntenCoocASMCh4</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; #   &lt;dbl&gt;, IntenCoocContrastCh3 &lt;dbl&gt;, IntenCoocContrastCh4 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; #   IntenCoocEntropyCh3 &lt;dbl&gt;, IntenCoocEntropyCh4 &lt;dbl&gt;, IntenCoocMaxCh3</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; #   &lt;dbl&gt;, IntenCoocMaxCh4 &lt;dbl&gt;, KurtIntenCh1 &lt;dbl&gt;, KurtIntenCh3 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; #   KurtIntenCh4 &lt;dbl&gt;, LengthCh1 &lt;dbl&gt;, NeighborAvgDistCh1 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; #   NeighborMinDistCh1 &lt;dbl&gt;, NeighborVarDistCh1 &lt;dbl&gt;, PerimCh1 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; #   ShapeBFRCh1 &lt;dbl&gt;, ShapeLWRCh1 &lt;dbl&gt;, ShapeP2ACh1 &lt;dbl&gt;, SkewIntenCh1</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; #   &lt;dbl&gt;, SkewIntenCh3 &lt;dbl&gt;, SkewIntenCh4 &lt;dbl&gt;, SpotFiberCountCh3</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31"><span class="co">#&gt; #   &lt;dbl&gt;, SpotFiberCountCh4 &lt;dbl&gt;, TotalIntenCh1 &lt;dbl&gt;, TotalIntenCh2</span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="co">#&gt; #   &lt;dbl&gt;, TotalIntenCh3 &lt;dbl&gt;, TotalIntenCh4 &lt;dbl&gt;, VarIntenCh1 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="co">#&gt; #   VarIntenCh3 &lt;dbl&gt;, VarIntenCh4 &lt;dbl&gt;, WidthCh1 &lt;dbl&gt;, XCentroid &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-34" data-line-number="34"><span class="co">#&gt; #   YCentroid &lt;dbl&gt;</span></a></code></pre></div>
<p>Selectors can also be used. For example, if only the predictors are needed, you can use <code>bake(object, newdata, all_predictors())</code>.</p>
</section>
<section id="adding-steps" class="level2">
<h2>Adding Steps</h2>
<p>After exploring the data, more preprocessing might be required. Steps can be added to the trained recipe. Suppose that we need to create PCA components but only from the predictors from channel 1 and any predictors that are areas:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">trained_rec &lt;-<span class="st"> </span>trained_rec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw">step_pca</span>(<span class="kw">ends_with</span>(<span class="st">&quot;Ch1&quot;</span>), <span class="kw">contains</span>(<span class="st">&quot;area&quot;</span>), <span class="dt">num =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">trained_rec</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; Data Recipe</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; Inputs:</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;       role #variables</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;    outcome          1</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  predictor         58</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; Training data contained 1009 data points and no missing data.</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; Operations:</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; Centering for AngleCh1, AreaCh1, ... [trained]</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; Scaling for AngleCh1, AreaCh1, ... [trained]</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; PCA extraction with ends_with(&quot;Ch1&quot;), contains(&quot;area&quot;)</span></a></code></pre></div>
<p>Note that only the last step has been estimated; the first two were previously trained and these activities are not duplicated. We can add the PCA estimates using <code>prep</code> again:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">trained_rec &lt;-<span class="st"> </span><span class="kw">prep</span>(trained_rec, <span class="dt">training =</span> seg_train)</a></code></pre></div>
<p><code>bake</code> can be reapplied to get the principal components in addition to the other variables:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">test_data  &lt;-<span class="st"> </span><span class="kw">bake</span>(trained_rec, <span class="dt">newdata =</span> seg_test, <span class="kw">all_predictors</span>())</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">names</span>(test_data)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;  [1] &quot;AvgIntenCh2&quot;          &quot;AvgIntenCh3&quot;          &quot;AvgIntenCh4&quot;         </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;  [4] &quot;DiffIntenDensityCh3&quot;  &quot;DiffIntenDensityCh4&quot;  &quot;EntropyIntenCh3&quot;     </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;  [7] &quot;EntropyIntenCh4&quot;      &quot;FiberAlign2Ch3&quot;       &quot;FiberAlign2Ch4&quot;      </span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; [10] &quot;IntenCoocASMCh3&quot;      &quot;IntenCoocASMCh4&quot;      &quot;IntenCoocContrastCh3&quot;</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; [13] &quot;IntenCoocContrastCh4&quot; &quot;IntenCoocEntropyCh3&quot;  &quot;IntenCoocEntropyCh4&quot; </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; [16] &quot;IntenCoocMaxCh3&quot;      &quot;IntenCoocMaxCh4&quot;      &quot;KurtIntenCh3&quot;        </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; [19] &quot;KurtIntenCh4&quot;         &quot;SkewIntenCh3&quot;         &quot;SkewIntenCh4&quot;        </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; [22] &quot;SpotFiberCountCh3&quot;    &quot;SpotFiberCountCh4&quot;    &quot;TotalIntenCh2&quot;       </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; [25] &quot;TotalIntenCh3&quot;        &quot;TotalIntenCh4&quot;        &quot;VarIntenCh3&quot;         </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; [28] &quot;VarIntenCh4&quot;          &quot;XCentroid&quot;            &quot;YCentroid&quot;           </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; [31] &quot;PC1&quot;                  &quot;PC2&quot;                  &quot;PC3&quot;                 </span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; [34] &quot;PC4&quot;                  &quot;PC5&quot;</span></a></code></pre></div>
<p>Note that the PCA components have replaced the original variables that were from channel 1 or measured an area aspect of the cells.</p>
<p>There are a number of different steps included in the package:</p>
<pre><code>#&gt;  [1] &quot;step_BoxCox&quot;        &quot;step_YeoJohnson&quot;    &quot;step_bagimpute&quot;    
#&gt;  [4] &quot;step_bin2factor&quot;    &quot;step_bs&quot;            &quot;step_center&quot;       
#&gt;  [7] &quot;step_classdist&quot;     &quot;step_corr&quot;          &quot;step_count&quot;        
#&gt; [10] &quot;step_date&quot;          &quot;step_depth&quot;         &quot;step_discretize&quot;   
#&gt; [13] &quot;step_downsample&quot;    &quot;step_dummy&quot;         &quot;step_factor2string&quot;
#&gt; [16] &quot;step_holiday&quot;       &quot;step_hyperbolic&quot;    &quot;step_ica&quot;          
#&gt; [19] &quot;step_interact&quot;      &quot;step_intercept&quot;     &quot;step_invlogit&quot;     
#&gt; [22] &quot;step_isomap&quot;        &quot;step_knnimpute&quot;     &quot;step_kpca&quot;         
#&gt; [25] &quot;step_lincomb&quot;       &quot;step_log&quot;           &quot;step_logit&quot;        
#&gt; [28] &quot;step_lowerimpute&quot;   &quot;step_meanimpute&quot;    &quot;step_modeimpute&quot;   
#&gt; [31] &quot;step_novel&quot;         &quot;step_ns&quot;            &quot;step_num2factor&quot;   
#&gt; [34] &quot;step_nzv&quot;           &quot;step_ordinalscore&quot;  &quot;step_other&quot;        
#&gt; [37] &quot;step_pca&quot;           &quot;step_poly&quot;          &quot;step_profile&quot;      
#&gt; [40] &quot;step_range&quot;         &quot;step_ratio&quot;         &quot;step_regex&quot;        
#&gt; [43] &quot;step_relu&quot;          &quot;step_rm&quot;            &quot;step_scale&quot;        
#&gt; [46] &quot;step_shuffle&quot;       &quot;step_spatialsign&quot;   &quot;step_sqrt&quot;         
#&gt; [49] &quot;step_string2factor&quot; &quot;step_unorder&quot;       &quot;step_upsample&quot;     
#&gt; [52] &quot;step_window&quot;        &quot;step_zv&quot;</code></pre>
</section>
<section id="checks" class="level2">
<h2>Checks</h2>
<p>Another type of operation that can be added to a recipes is a <em>check</em>. Checks conduct some sort of data validation and, if no issue is found, returns the data as-is; otherwise, an error is thrown.</p>
<p>For example, <code>check_missing</code> will fail if any of the variables selected for validation have missing values. This check is done when the recipe is prepared as well as when any data are baked. Checks are added in the same way as steps:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">trained_rec &lt;-<span class="st"> </span>trained_rec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">check_missing</span>(<span class="kw">contains</span>(<span class="st">&quot;Inten&quot;</span>))</a></code></pre></div>
<p>Currently, <code>recipes</code> includes:</p>
<pre><code>#&gt; [1] &quot;check_cols&quot;    &quot;check_missing&quot;</code></pre>
</section>

<script type="text/javascript">
window.onload = function() {
  var i, fig = 1, caps = document.getElementsByClassName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.className !== 'figure' || cap.nodeName !== 'P')
      continue;
    cap.innerHTML = '<span>Figure ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
  fig = 1;
  caps = document.getElementsByTagName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.nodeName !== 'TABLE') continue;
    cap.innerHTML = '<span>Table ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
}
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
